<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Consumer Price Index Percent Change, 2002 - 2022</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Alegreya+Sans:ital,wght@0,300;0,400;0,700;1,400&family=Alegreya:ital,wght@0,400..900;1,400..900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="cpi_styles.css">

</head>

<body>

    <!--Header-->
    <div id="top">
        <h1>Consumer Price Index:</br>Food Consumed <span class="athome">at Home</span> and <span class="notathome">Away
                from
                Home</span></h1>
        <h3>Percent Change Year to Year, 2002 - 2022</h3>
        <P>Toggle visibility:
            <!--Buttons-->
            <button id="buttonAway">ğŸš— Food Away from Home </button>
            <button id="buttonHome">ğŸ  Food at Home</button>
            (
            <button class="subcategory" id="buttonFruit">ğŸŠ Fruits</button>
            <button class="subcategory" id="buttonVeg">ğŸ¥¬ Vegetables</button>
            <button class="subcategory" id="buttonMeat">ğŸ¥© Meat</button>
            <button class="subcategory" id="buttonDairy">ğŸ§€ Dairy</button>)
        </P>
    </div>


    <script type="text/javascript">

        //Consts/global variables  
        const w = 800;
        const h = 500;
        const margin = 50;
        const parseTime = d3.timeParse("%Y");//time parser - changed to just show the year


        /* Data - percent change to the U.S. Consumer Price Index (CPI) for food (at home and out of home) between 2002 and 2022. 
        Source: https://www.ers.usda.gov/data-products/food-price-outlook.aspx */

        d3.csv("cpi_change.csv").then(data => {
            console.log("data", data)

        
            data.forEach(d => {
                    d.year = parseTime(d.year);
                    d.away = +d.away;
                    d.home = +d.home;
                    d.fruit = +d.fruit;
                    d.veg = +d.veg;
                    d.dairy = +d.dairy;
                    d.meat = +d.meat;
                });



            //scales
            const xScale = d3.scaleTime()
                .domain(d3.extent(data, d => d.year))
                .range([margin, w - margin]);

            const yScale = d3.scaleLinear()
                .domain([0, d3.max(data, d => Math.max(d.away, d.home))])
                .range([h - margin, margin]);

            //SVG
            const svg = d3.select("body")
                .append("svg")
                .attr("width", w)
                .attr("height", h);

                  //negative percent change
                  svg.append("rect")
                    .attr("x", 50)
                    .attr("y", 392)
                    .attr("width", w - 98)
                    .attr("height", 55)
                    .attr("id", "negative")

            //bottom axis 
            const bottomAxis = d3.axisBottom()
                .scale(xScale)
                .tickFormat(d3.timeFormat("%Y"));

            svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(0," + (h - margin) + ")")
                .call(bottomAxis);

            //left axis
            const leftAxis = d3.axisLeft()
                .scale(yScale);

            svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(" + margin + ",0)")
                .call(leftAxis);

            //NEW(ish) create a function in which we make our line
            function drawData(which) {

                //NEW(ish)line generator a function to change y
                const coords = d3.line()
                    .x(d => xScale(d.date))
                    .y(function (d) {
                        if (which == "away") { return yScale(d.away) }
                        else if (which == "home") { return yScale(d.home) }
                        else if (which == "fruit") { return yScale(d.fruit) }
                        else if (which == "veg") { return yScale(d.veg) }
                        else { return yScale(d.dairy) }
                    });


               
            }

            //NEW: buttons with .on and data change
            d3.selectAll("button").on("click", (event, d) => {
                const selected = event.currentTarget;
                if (selected.id == "buttonHome") {
                    drawData("home")
                } else if (selected.id == "buttonAway") {
                    drawData("away")
                } else if (selected.id == "buttonFruit") {
                    drawData("fruit")
                } else if (selected.id == "buttonVeg") {
                    drawData("veg")
                } else {
                    drawData("meat")
                }
            })

        });

    </script>
</body>

</html>